#!/usr/bin/env mayapy

#nosetests --with-doctest -v pymel --exclude '(windows)|(tools)|(arrays)|(example1)'

#import doctest
import sys, platform, os, shutil

try:
	import nose
except ImportError, e:
	"To run pymel's tests you must have nose installed: http://code.google.com/p/python-nose"
	raise e

app_dir = os.environ['HOME']
if platform.system() == 'Darwin':
	app_dir = os.path.join( app_dir, 'Library/Preferences/Autodesk/maya' )	
else:
	app_dir = os.path.join( app_dir, 'maya' )

print "backing up Maya user directory", app_dir
shutil.move( app_dir, app_dir + '.bak' )

#import maya

#SKIP_MAYA_8_5 = doctest.register_optionflag('SKIP_MAYA_8_5')
#SKIP_MAYA_2008 = doctest.register_optionflag('SKIP_MAYA_2008')
#SKIP_MAYA_2009 = doctest.register_optionflag('SKIP_MAYA_2009')

#class MayaOutputChecker(doctest.

exclusion = 'windows tools example1 .*testingutils pmcmds testPa'
#arrays 
args = ['empty']
args += "--with-doctest -v pymel --noexe ".split()
#args += ['--pdb']
args += ['--exclude', '|'.join( [ '(%s)' % x for x in exclusion.split() ] )  ]
args += sys.argv[1:]

try:
	nose.main( argv=args )
except Exception, e:
	print e
finally:
	print "restoring Maya user directory", app_dir
	shutil.rmtree( app_dir )
	shutil.move( app_dir + '.bak', app_dir )
	print "done"
